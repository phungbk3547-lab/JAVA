<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Quản lý Khiếu nại | EV Trading</title>

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          crossorigin="anonymous" referrerpolicy="no-referrer"/>

    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script th:src="@{/js/script.js}" defer></script>
</head>
<body class="admin-body">

<!-- Header chung -->
<div th:replace="~{fragments/header :: header}"></div>

<div class="app-shell">

    <!-- MENU TRÁI ADMIN -->
    <aside class="side-nav admin-side-nav">
        <div class="side-nav-group">
            <div class="side-nav-title">Quản trị</div>

            <a th:href="@{/admin/dashboard}" class="side-link">
                <i class="fa-solid fa-gauge-high"></i> Tổng quan
            </a>

            <a th:href="@{/admin/complaint}" class="side-link active">
                <i class="fa-solid fa-flag"></i> Khiếu nại
                <span th:if="${complaintCount > 0}"
                      class="badge-count"
                      th:text="${complaintCount}">0</span>
            </a>

            <a th:href="@{/logout}" class="side-link">
                <i class="fa-solid fa-right-from-bracket"></i> Đăng xuất
            </a>
        </div>
    </aside>

    <!-- MAIN -->
    <main class="app-content admin-content">

        <h1 class="admin-heading">Danh sách báo cáo vi phạm</h1>
        <p class="admin-subtitle">
            Kiểm tra các khiếu nại của người dùng và xử lý bài viết vi phạm.
        </p>

        <div class="complaint-card">
            <div class="table-responsive" style="box-shadow:none;border:none;padding:0;">
                <table class="complaint-table" style="width:100%;border-collapse:collapse;">
                    <thead>
                    <tr>
                        <th style="padding-left:24px;">Người báo cáo</th>
                        <th>Bài viết báo cáo</th>
                        <th>Lý do</th>
                        <th>Ngày báo</th>
                        <th style="text-align:right;padding-right:24px;">Hành động</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="c : ${complaints}">
                        <!-- Reporter -->
                        <td style="padding-left:24px;">
                            <div class="info-group">
                                <span class="info-main"
                                      th:text="${c.reporter.name}">Nguyễn Văn A</span>
                                <span class="info-sub"
                                      th:text="${c.reporter.email}">email@example.com</span>
                            </div>
                        </td>

                        <!-- Post -->
                        <td>
                            <div class="info-group" th:if="${c.post != null}">
                                <a th:href="@{/posts/{id}(id=${c.post.id})}"
                                   target="_blank"
                                   class="info-main complaint-link">
                                    <span th:text="${c.post.title}">Tiêu đề bài viết</span>
                                    <i class="fas fa-external-link-alt"
                                       style="font-size:10px;margin-left:4px;"></i>
                                </a>
                                <span class="info-sub"
                                      th:text="'Người bán: ' + ${c.post.user.name}">
                                    Seller Name
                                </span>
                            </div>

                            <div class="info-group" th:if="${c.post == null}">
                                <span class="info-main"
                                      style="color:#a1a1aa;text-decoration:line-through;">
                                    Bài viết đã xóa
                                </span>
                            </div>
                        </td>

                        <!-- Reason -->
                        <td>
                            <div class="reason-box">
                                <span th:text="${c.reason}">
                                    Lý do lừa đảo...
                                </span>
                            </div>
                        </td>

                        <!-- Date -->
                        <td>
                            <span class="info-sub"
                                  style="font-size:13px;"
                                  th:text="${#dates.format(c.createdAt, 'dd/MM/yyyy')}">
                                01/01/2025
                            </span>
                        </td>

                        <!-- Action -->
                        <td style="text-align:right;padding-right:24px;">
                            <div th:if="${c.status == 'PENDING'}"
                                 class="btn-action-group" style="justify-content:flex-end;">

                                <form th:action="@{/admin/complaint/dismiss/{id}(id=${c.id})}"
                                      method="post">
                                    <button class="btn-icon-large btn-dismiss"
                                            title="Báo cáo sai - Bỏ qua">
                                        <i class="fas fa-shield-alt"></i>
                                    </button>
                                </form>

                                <form th:action="@{/admin/complaint/accept/{id}(id=${c.id})}"
                                      method="post"
                                      onsubmit="return confirm('Xác nhận ĐÁNH DẤU VI PHẠM bài này?');">
                                    <button class="btn-icon-large btn-punish"
                                            title="Xác nhận vi phạm">
                                        <i class="fas fa-gavel"></i>
                                    </button>
                                </form>
                            </div>

                            <div th:if="${c.status == 'RESOLVED'}">
                                <span class="status-badge status-approved">
                                    <i class="fas fa-check-double"></i> Đã xử lý
                                </span>
                            </div>
                        </td>
                    </tr>

                    <!-- Không có khiếu nại -->
                    <tr th:if="${#lists.isEmpty(complaints)}">
                        <td colspan="5" style="text-align:center;padding:48px 16px;">
                            <img src="https://cdn-icons-png.flaticon.com/512/7486/7486747.png"
                                 width="80"
                                 style="opacity:.5;margin-bottom:12px;">
                            <p style="color:#a1a1aa;">
                                Không có khiếu nại nào cần xử lý.
                            </p>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <footer class="footer admin-footer">
            © 2025 EV Trading Platform ⚡ — Quản lý khiếu nại
        </footer>
    </main>
</div>

</body>
</html>
